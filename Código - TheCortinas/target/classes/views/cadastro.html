<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,minimum-scale=1">
    <!-- Import bootstrap css ---------------------------------------->
    <link rel="stylesheet" href="/style/bootstrap.min.css" type="text/css"> 
    <!-- ---------------------------------------------------------- -->
    <link rel="stylesheet" href="/style/style-cadastro.css" type="text/css">
    <link rel="shortcut icon" href="/images/deathstar.ico" type="image/x-icon">
    <script src="/js/bootstrap.min.js"></script>
    <title>Fazer Registro - Cortinas</title>
</head>
<body>
  <div class = "container-fluid">


    <!--HEADER-->
    <header class="row">

      <div class="col-12">
        <p><a href="login">Cortinas</a></p>
      </div>
   
        
    </header>
      <!--HEADER-->

      <section class="row">
        <div class = "col-12">
          <h1 class="welcomereg"> Para se Registrar, preencha corretamente todos os dados requisitados abaixo:  </h1>
        </div>
        
      </section>
        

     
  
      <!-- <div class = "statusmsg alert col-sm-12"><%= message %></div> -->

      <section class="row justify-content-center">
        <section class= "col-lg-6 col-sm-10 col-xs-7">

          <form role="form" method="post" class="form-container">
            <label>Nome Completo</label>
            <input type="text" id="userCompleteName" class="form-control" required name="nome_completo" >
            <br>
            <label>Data de Nascimento</label>
            <input type="date" id="birthday"  class="form-control" name="data_nascimento" required>
            <br>
            <label>Cidade</label>
            <input type="text" id="cidade" class="form-control" name="cidade" required>
            <br>
            <label>Estado</label>
            <input type="text" id="estado" class="form-control" name="estado" required>
            <br>
            <div>
              <label>Username</label>
              <input type="text"  id="username" class="form-control" name="username" >
      
      
            </div>
            <br>
            <div class="mb-3">
              <label for="exampleInputPassword1" class="form-label">Senha</label>
              <input type="password" id="userPassword" class="form-control" id="exampleInputPassword1" name="password">
            </div>
      
            
            <!--<button type="submit" onclick="criarUser();criarUserNamePassword()" class="btn btn-primary btn-lg buttoncfg">Enviar</button>-->
            <input type="button" onclick="criarUser();criarUserNamePassword()" value="Criar" class="btn btn-primary btn-lg buttoncfg">

      
      
          </form>
        </section>
      </section>
      
  
  
      <div class= "row">
        <div class="col-12 col-sm-6 col-md-3">
          <footer>
            <p>
            <a href="http://github.com/vceesar/cortinas">PPADS by The Cortinas.</a>
            </p>
          </footer>
        </div>
      </div>


      <!--END Container-Fluid-->
  </div>
<script>
  const userCompleteName= document.querySelector("#userCompleteName");
  const birthday= document.querySelector("#birthday");
  const cidade= document.querySelector("#cidade");
  const estado= document.querySelector("#estado");



  function mostrarMensagem(teste) {
        confirm("Cadastro criado!")?location.replace("/"):location.replace("/");
    }

  function loginCriado(login){
  // confirm("Login criado!")?location.reload():location.reload();

  }

  async function criarUser(){
  const URL= "/cortinas/user";
  const dadosUser={
    "name": userCompleteName.value,
    "birthday": birthday.value,
    "cidade": cidade.value,
    "estado": estado.value};


  const postRequest1={
  method: 'POST',
  body: JSON.stringify(dadosUser),
  headers: {'Content-type': 'application/json;charset=UTF-8'}
  };
    try{
        fetch(URL, postRequest1).then(resposta => resposta.json()).then(jsonResponse => mostrarMensagem(jsonResponse));
    }catch(e){
    corpoTabela.innerHTML=e;

    }
    }

  const username= document.querySelector("#username");
  const userpassword= document.querySelector("#userPasword");

  async function criarUserNamePassword(){
  const URL= "/cortinas/login";
  const dadosUserNameLogin={
    "userName": username.value,
    "userPassword": userPassword.value};

  const postRequest2={
  method: 'POST',
  body: JSON.stringify(dadosUserNameLogin),
  headers: {'Content-type': 'application/json;charset=UTF-8'}
  };
    try{
        fetch(URL, postRequest2).then(resposta => resposta.json()).then(jsonResponse => loginCriado(jsonResponse));
    }catch(e){
    corpoTabela.innerHTML=e;

    }
    }
</script>
  
</body>
</html>